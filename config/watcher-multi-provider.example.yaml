# Multi-Provider Watcher Configuration Example
# This example shows how to configure multiple providers with provider-specific prompt templates

server:
  host: 0.0.0.0
  port: 3000

deduplication:
  enabled: true
  # Prevents duplicate work by skipping events where the bot already commented
  # Bot username configuration is provider-specific (see each provider's options)
  commentTemplate: "Agent is working on {id}"

logLevel: info

# Command executor configuration
commandExecutor:
  enabled: true

  # Command to execute - receives rendered prompt via stdin or $PROMPT
  command: "cs llm session run --approval=auto --name=$EVENT_SHORT_ID"

  # Single template works for all current providers (GitHub, GitLab, Linear)
  # All three are code platforms with similar PR-based workflows
  promptTemplateFile: ./config/event-prompt.example.hbs

  # Provider-specific templates (for future use with different platform types)
  # Uncomment when you need different workflows for different providers:
  # prompts:
  #   slack: ./config/event-prompt-slack.example.hbs  # When Slack provider is added
  #   # github, gitlab, linear will fall back to promptTemplateFile above

  useStdin: true
  followUp: true

# Multiple providers configuration
providers:
  # GitHub: Issues and Pull Requests
  github:
    enabled: true
    pollingInterval: 60

    auth:
      type: token
      tokenEnv: GITHUB_TOKEN

    options:
      webhookSecretEnv: GITHUB_WEBHOOK_SECRET

      # Bot username(s) for deduplication, activity from this user will be skipped.
      botUsername: auto-coder-bot

      repositories:
        - owner/backend-api
        - owner/frontend-app

      events:
        - issues
        - pull_request
        - issue_comment

      initialLookbackHours: 1
      maxItemsPerPoll: 50

  # GitLab: Issues and Merge Requests
  gitlab:
    enabled: true
    pollingInterval: 60

    auth:
      type: token
      tokenEnv: GITLAB_TOKEN

    options:
      webhookTokenEnv: GITLAB_WEBHOOK_TOKEN

      # Bot username(s) for deduplication, activity from this user will be skipped.
      botUsername: auto-coder-bot

      projects:
        - group/infrastructure
        - group/tooling

      events:
        - issues
        - merge_requests

      initialLookbackHours: 1
      maxItemsPerPoll: 50

  # Linear: Team-based task tracking
  linear:
    enabled: true
    pollingInterval: 60

    auth:
      type: token
      tokenEnv: LINEAR_API_KEY

    options:
      webhookSecretEnv: LINEAR_WEBHOOK_SECRET

      # Bot username(s) for deduplication, activity from this user will be skipped.
      # Linear usernames are in the format "john-doe"
      botUsername: auto-coder-bot

      # Monitor specific teams
      teams:
        - ENG      # Engineering
        - PRODUCT  # Product Management

      initialLookbackHours: 1
      maxItemsPerPoll: 50

  # Slack: Mention-triggered responses
  # Unlike other providers, Slack only triggers when bot is @mentioned
  slack:
    enabled: false

    auth:
      type: token
      tokenEnv: SLACK_BOT_TOKEN

    options:
      # Signing secret for webhook verification
      signingSecretEnv: SLACK_SIGNING_SECRET

      # Note: Bot user ID is automatically detected via Slack API
      # No botUsername configuration is needed for Slack

      # Note: Slack provider automatically filters to app_mention events only
      # No need to configure channels - bot responds in any channel where it's added
      # and someone @mentions it
