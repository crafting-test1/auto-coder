# Watcher Configuration with Command Executor
# This example shows how to configure the watcher with command execution

server:
  host: 0.0.0.0
  port: 3000

deduplication:
  enabled: true
  botUsername: auto-coder-bot
  commentTemplate: "Agent is working on {id}"

logLevel: info

# Command executor configuration
# This is the core workflow: execute a command when events are received
commandExecutor:
  enabled: true

  # Dry-run mode: Print command without executing (for testing/debugging)
  # When enabled, logs the command, environment variables, and prompt without execution
  dryRun: false

  # Command to execute for each event
  # This could be any command, such as:
  # - An AI agent CLI: "claude-code" or "openai-cli"
  # - A custom script: "./scripts/process-issue.sh"
  # - A pipeline: "parse-event | analyze | respond"
  #
  # Available environment variables:
  # - EVENT_ID: Full event identifier (e.g., "github:owner/repo:opened:123:uuid")
  # - EVENT_SAFE_ID: Sanitized ID safe for shell (e.g., "github_owner_repo_opened_123_uuid")
  # - EVENT_SHORT_ID: Short, unique ID (e.g., "github-owner-repo-123-abc123") RECOMMENDED
  #   Format: provider-repo-number-hash
  #   Examples: "github-owner-repo-123-abc123", "linear-ENG-456-def789"
  #   Hash suffix (6 chars) ensures uniqueness for all events
  # - PROMPT: Rendered prompt with all event details (if useStdin=false)
  #
  # All event context is included in the PROMPT (rendered from promptTemplateFile).
  # The template has access to the full event structure and can format it as needed.
  command: "echo \"$PROMPT\" | your-ai-agent-command"

  # Load prompt template from file (recommended)
  # The template receives the normalized event data from any provider
  promptTemplateFile: ./config/event-prompt.example.hbs

  # For future multi-provider setups with different platform types:
  # prompts:
  #   slack: ./config/event-prompt-slack.example.hbs  # Different workflow for conversational platforms
  # promptTemplateFile: ./config/event-prompt.example.hbs  # Fallback for code platforms

  # Pass prompt via stdin (recommended for large prompts)
  useStdin: true

  # Post command output as follow-up comment
  # If true: Updates the "Agent is working" comment with command output
  # If false: Only posts the initial comment
  followUp: true

providers:
  github:
    enabled: true
    pollingInterval: 60

    auth:
      type: token
      tokenEnv: GITHUB_TOKEN

    options:
      # Webhook secret for signature verification (recommended for production)
      # You can provide the secret directly, via environment variable, or from a file
      # webhookSecret: "your-secret-here"
      webhookSecretEnv: GITHUB_WEBHOOK_SECRET
      # webhookSecretFile: /path/to/secret/file

      repositories:
        - owner/repo1
        - owner/repo2

      events:
        - issues
        - pull_request

      initialLookbackHours: 1
      maxItemsPerPoll: 50
