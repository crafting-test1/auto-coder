# Watcher Configuration Example
# Copy this file to watcher.yaml and update with your values

# Server configuration for webhook endpoints
server:
  host: 0.0.0.0
  port: 3000
  # Optional base path for all webhook endpoints
  # basePath: /api

# Event deduplication configuration
# Uses comment-based deduplication: checks last comment on issues/PRs
deduplication:
  enabled: true

  # Bot username (required)
  # This should be the username of the account posting comments
  botUsername: auto-coder-bot

  # Comment template (optional)
  # Use {id} placeholder for event ID
  commentTemplate: "Agent is working on session {id}"

# Log level: debug | info | warn | error
logLevel: info

# Command executor configuration
commandExecutor:
  enabled: false  # Set to true to enable command execution for events

  # Command to execute (required if enabled)
  # The command receives event data via environment variables or stdin
  command: "echo 'Event received: $EVENT_ID'"

  # Prompt template (optional)
  # Uses Handlebars syntax to render event data into a prompt
  # promptTemplate: |
  #   Event: {{provider}}/{{type}}/{{action}}
  #   Resource: {{resource.title}}
  #   URL: {{resource.url}}

  # Or load template from file (recommended)
  # Use the production-tested template from samples/watch.go:
  # promptTemplateFile: ./config/event-prompt.example.hbs

  # Pass prompt via stdin instead of environment variable (default: false)
  useStdin: false

  # Post initial comment before executing command (default: false)
  postInitialComment: false

  # Initial comment template (optional, uses default if not specified)
  # initialCommentTemplate: "ðŸ¤– Agent is processing event {{id}}"

  # Post command output as comment (default: false)
  postOutputComment: false

# Provider configurations
providers:
  # GitHub Provider
  github:
    enabled: true

    # Webhook mode is always enabled for receiving events from GitHub
    # (Implement your own security/authentication at the reverse proxy or API gateway level)

    # Polling configuration (optional - enables polling mode if auth + repositories are provided)
    pollingInterval: 60  # Polling interval in seconds

    # Authentication (required for polling mode and comment-based deduplication)
    auth:
      type: token

      # Option 1: Direct token (not recommended for production)
      # token: ghp_your_token_here

      # Option 2: From environment variable (recommended)
      tokenEnv: GITHUB_TOKEN

      # Option 3: From file
      # tokenFile: /path/to/token.txt

      # Option 4: Interpolate from environment in YAML
      # token: ${GITHUB_TOKEN}

    # GitHub-specific options
    options:
      # Repositories to monitor (required for polling mode)
      repositories:
        - owner/repo1
        - owner/repo2

      # Event types to monitor (optional, defaults to all)
      events:
        - issues
        - pull_request
        - issue_comment

  # Additional providers can be configured here
  # gitlab:
  #   enabled: false
  #   mode: webhook
  #   ...

  # jira:
  #   enabled: false
  #   mode: polling
  #   ...

  # linear:
  #   enabled: false
  #   mode: both
  #   ...
