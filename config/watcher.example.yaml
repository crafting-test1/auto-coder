# Watcher Configuration Example
# Copy this file to watcher.yaml and update with your values

# Server configuration for webhook endpoints
server:
  host: 0.0.0.0
  port: 3000
  # Optional base path for all webhook endpoints
  # basePath: /api

# Event deduplication configuration
# Uses comment-based deduplication: checks last comment on issues/PRs
deduplication:
  enabled: true

  # Bot username (required)
  # This should be the username of the account posting comments
  botUsername: auto-coder-bot

  # Comment template (optional)
  # Use {id} placeholder for event ID
  commentTemplate: "Agent is working on session {id}"

# Log level: debug | info | warn | error
logLevel: info

# Command executor configuration
# When enabled, executes a command for each event with the prompt and event data
commandExecutor:
  enabled: false  # Set to true to enable command execution

  # Command to execute (required if enabled)
  # The command receives event data via environment variables:
  # - EVENT_ID: Unique event identifier
  # - PROMPT: Rendered prompt (if promptTemplate is provided)
  # - EVENT_ACTION: Event action (e.g., "opened", "closed")
  # - EVENT_REPOSITORY: Repository full name (e.g., "owner/repo")
  command: "echo \"Processing event $EVENT_ID\""

  # Prompt template (optional)
  # Uses Handlebars syntax to render event data into a prompt
  # The template receives the raw provider event data
  # promptTemplate: |
  #   Issue: {{issue.title}}
  #   Action: {{action}}
  #   Repository: {{repository.full_name}}

  # Or load template from file (recommended)
  # Use the production-tested template adapted from samples/watch.go:
  # promptTemplateFile: ./config/event-prompt.example.hbs

  # Pass prompt via stdin instead of environment variable (default: false)
  # If true, prompt is sent to command's stdin; if false, via $PROMPT env var
  useStdin: false

  # Post command output as follow-up comment (default: false)
  # If true, updates the initial "Agent is working" comment with command output
  # If false, only posts the initial comment
  followUp: false

# Provider configurations
providers:
  # GitHub Provider
  github:
    enabled: true

    # Webhook mode is always enabled for receiving events from GitHub
    # (Implement your own security/authentication at the reverse proxy or API gateway level)

    # Polling configuration (optional - enables polling mode if auth + repositories are provided)
    pollingInterval: 60  # Polling interval in seconds

    # Authentication (required for polling mode and comment-based deduplication)
    auth:
      type: token

      # Option 1: Direct token (not recommended for production)
      # token: ghp_your_token_here

      # Option 2: From environment variable (recommended)
      tokenEnv: GITHUB_TOKEN

      # Option 3: From file
      # tokenFile: /path/to/token.txt

      # Option 4: Interpolate from environment in YAML
      # token: ${GITHUB_TOKEN}

    # GitHub-specific options
    options:
      # Webhook secret for signature verification (optional but recommended for production)
      # GitHub signs webhook payloads with HMAC SHA-256 using this secret
      # Configure the same secret in your GitHub webhook settings
      # You can provide the secret directly, via environment variable, or from a file
      # webhookSecret: "your-secret-here"
      webhookSecretEnv: GITHUB_WEBHOOK_SECRET
      # webhookSecretFile: /path/to/secret/file

      # Repositories to monitor (required for polling mode)
      repositories:
        - owner/repo1
        - owner/repo2

      # Event types to monitor (optional, defaults to all)
      events:
        - issues
        - pull_request
        - issue_comment

      # Initial lookback period for first poll (optional, default: 1 hour)
      # When first polling a repository, only fetch items from the last N hours
      # This prevents overwhelming the system with hundreds of old issues
      # Examples: 1 (1 hour, default), 6 (6 hours), 24 (1 day), 168 (1 week)
      initialLookbackHours: 1

      # Maximum items to process per poll (optional, default: unlimited)
      # Limits the total number of issues/PRs processed across all repositories
      # Useful to prevent rate limiting and reduce processing load
      maxItemsPerPoll: 50

  # Additional providers can be configured here
  # gitlab:
  #   enabled: false
  #   mode: webhook
  #   ...

  # jira:
  #   enabled: false
  #   mode: polling
  #   ...

  # linear:
  #   enabled: false
  #   mode: both
  #   ...
